{% extends "base.html" %}

{% block title %}Gestión de Pedidos - DomiFlash{% endblock %}

{% block content %}
<!-- Header de pedidos -->
<section class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white py-12">
  <div class="container mx-auto px-6">
    <div class="text-center">
      <div class="mx-auto w-20 h-20 bg-white bg-opacity-20 rounded-full flex items-center justify-center text-4xl mb-4">
        📦
      </div>
      <h1 class="text-4xl font-bold mb-2">Gestión de Pedidos</h1>
      <p class="text-blue-100">Administra tus entregas de manera eficiente</p>
    </div>
  </div>
</section>

<div class="dark-bg min-h-screen py-8">
  <div class="container mx-auto px-6">
    <!-- Pedidos Disponibles -->
    <div class="mb-8">
      <div class="flex items-center gap-3 mb-6">
        <h2 class="text-2xl font-bold dark-text">🎆 Pedidos Disponibles</h2>
        <span class="bg-blue-500 text-white px-3 py-1 rounded-full text-sm font-medium">
          {{ pedidos_disponibles|length }} disponibles
        </span>
      </div>
      
      {% if pedidos_disponibles %}
      <div class="grid gap-4">
        {% for pedido in pedidos_disponibles %}
        <div class="dark-card p-6 border-l-4 border-blue-500 hover:shadow-lg transition-all duration-300">
          <div class="flex justify-between items-start">
            <div class="flex-1">
              <div class="flex items-center gap-3 mb-3">
                <h3 class="text-lg font-bold dark-text">Pedido #{{ pedido.idped }}</h3>
                <span class="px-3 py-1 bg-yellow-100 text-yellow-800 rounded-full text-sm font-medium">
                  {{ pedido.estped|title }}
                </span>
              </div>
              
              <div class="grid md:grid-cols-2 gap-4 mb-4">
                <div>
                  <p class="dark-text"><strong>👤 Cliente:</strong> {{ pedido.cliente }}</p>
                  <p class="dark-text"><strong>📍 Dirección:</strong> {{ pedido.dirusu }}</p>
                </div>
                <div>
                  <p class="dark-text"><strong>🍽️ Restaurante:</strong> {{ pedido.nomres }}</p>
                  <p class="dark-text"><strong>💰 Total:</strong> <span class="text-green-600 font-bold">${{ pedido.total }}</span></p>
                </div>
              </div>
              
              <p class="text-sm dark-text-secondary">
                <strong>🕰️ Creado:</strong> {{ pedido.fecha_creacion.strftime('%d/%m/%Y %H:%M') }}
              </p>
            </div>
            
            <div class="text-right ml-4">
              <form action="{{ url_for('repartidor.tomar_pedido', pedido_id=pedido.idped) }}" method="POST">
                <button type="submit" class="btn-primary">
                  ⚡ Tomar Pedido
                </button>
              </form>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <div class="dark-card p-8 text-center">
        <div class="text-6xl mb-4">😴</div>
        <p class="dark-text-secondary text-lg">No hay pedidos disponibles en este momento.</p>
        <p class="dark-text-secondary text-sm mt-2">Vuelve a consultar en unos minutos.</p>
      </div>
      {% endif %}
    </div>
    
    <!-- Mis Pedidos Asignados -->
    <div>
      <div class="flex items-center gap-3 mb-6">
        <h2 class="text-2xl font-bold dark-text">🛡️ Mis Pedidos Asignados</h2>
        <span class="bg-green-500 text-white px-3 py-1 rounded-full text-sm font-medium">
          {{ pedidos_asignados|length }} asignados
        </span>
      </div>
      
      {% if pedidos_asignados %}
      <div class="grid gap-4">
        {% for pedido in pedidos_asignados %}
        <div class="dark-card p-6 border-l-4 border-green-500 hover:shadow-lg transition-all duration-300">
          <div class="flex justify-between items-start">
            <div class="flex-1">
              <div class="flex items-center gap-3 mb-3">
                <h3 class="text-lg font-bold dark-text">Pedido #{{ pedido.idped }}</h3>
                <span class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-medium">
                  {{ pedido.estped|title }}
                </span>
              </div>
              
              <div class="grid md:grid-cols-2 gap-4 mb-4">
                <div>
                  <p class="dark-text"><strong>👤 Cliente:</strong> {{ pedido.cliente }}</p>
                  <p class="dark-text"><strong>📍 Dirección:</strong> {{ pedido.dirusu }}</p>
                </div>
                <div>
                  <p class="dark-text"><strong>🍽️ Restaurante:</strong> {{ pedido.nomres }}</p>
                  <p class="dark-text"><strong>💰 Total:</strong> <span class="text-green-600 font-bold">${{ pedido.total }}</span></p>
                </div>
              </div>
              
              <p class="text-sm dark-text-secondary">
                <strong>🕰️ Asignado:</strong> {{ pedido.fecha_creacion.strftime('%d/%m/%Y %H:%M') }}
              </p>
            </div>
            
            <div class="text-right ml-4">
              <div class="space-y-2">
                <button class="btn-secondary text-sm" onclick="verDetalle({{ pedido.idped }})">
                  🔍 Ver Detalle
                </button>
                {% if pedido.estped not in ['entregado', 'cancelado'] %}
                <form action="{{ url_for('repartidor.actualizar_estado', pedido_id=pedido.idped) }}" method="POST" class="inline">
                  <select name="estado" class="input text-sm mb-1" onchange="this.form.submit()">
                    <option value="">Cambiar estado...</option>
                    {% if pedido.estped == 'aceptado' %}
                    <option value="en_camino">En Camino</option>
                    {% elif pedido.estped == 'preparando' %}
                    <option value="en_camino">En Camino</option>
                    {% elif pedido.estped == 'en_camino' %}
                    <option value="entregado">Entregado</option>
                    {% endif %}
                  </select>
                </form>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <div class="dark-card p-8 text-center">
        <div class="text-6xl mb-4">🎯</div>
        <p class="dark-text-secondary text-lg">No tienes pedidos asignados actualmente.</p>
        <p class="dark-text-secondary text-sm mt-2">Toma algunos pedidos de la sección de disponibles.</p>
      </div>
      {% endif %}
    </div>
  </div>
</div>

<script>
function verDetalle(pedidoId) {
    alert(`Viendo detalles del pedido #${pedidoId}`);
}

function marcarEntregado(pedidoId) {
    if (confirm('¿Estás seguro de marcar este pedido como entregado?')) {
        alert(`Pedido #${pedidoId} marcado como entregado ✓`);
    }
}
</script>
{% endblock %}