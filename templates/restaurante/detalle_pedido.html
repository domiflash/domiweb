{% extends "base.html" %}

{% block title %}Detalle Pedido #{{ pedido.idped }} - DomiFlash{% endblock %}

{% block content %}
<div class="min-h-screen dark-bg py-8">
  <div class="max-w-4xl mx-auto px-6">
    <!-- Header con navegación -->
    <div class="mb-8">
      <div class="flex items-center justify-between mb-6">
        <div class="flex items-center space-x-4">
          <a href="{{ url_for('restaurante.listar_pedidos') }}" 
             class="bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 p-2 rounded-lg transition-colors">
            <svg class="w-5 h-5 dark-text" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
            </svg>
          </a>
          <div>
            <h1 class="text-3xl font-bold dark-text">📋 Detalle del Pedido #{{ pedido.idped }}</h1>
            <p class="text-gray-600 dark:text-gray-400">Información completa del pedido</p>
          </div>
        </div>
        
        <!-- Estado actual -->
        <div class="text-right">
          <div class="estado-badge estado-{{ pedido.estped.replace(' ', '_') }}">
            {% if pedido.estped == 'pendiente' %}⏳ Pendiente
            {% elif pedido.estped == 'aceptado' %}✅ Aceptado
            {% elif pedido.estped == 'preparando' %}👨‍🍳 Preparando
            {% elif pedido.estped == 'en_camino' %}🚚 En Camino
            {% elif pedido.estped == 'entregado' %}✅ Entregado
            {% elif pedido.estped == 'cancelado' %}❌ Cancelado
            {% else %}{{ pedido.estped }}
            {% endif %}
          </div>
          <div class="text-sm text-gray-500 dark:text-gray-400 mt-2">
            {{ pedido.fecha_creacion.strftime('%d/%m/%Y %H:%M') if pedido.fecha_creacion else 'Sin fecha' }}
          </div>
        </div>
      </div>
    </div>

    <div class="grid lg:grid-cols-3 gap-8">
      <!-- Información del pedido -->
      <div class="lg:col-span-2">
        <!-- Productos del pedido -->
        <div class="dark-card mb-6">
          <div class="p-6 border-b dark-border">
            <h2 class="text-xl font-bold dark-text flex items-center gap-2">
              🍽️ Productos del Pedido
            </h2>
          </div>
          
          {% if productos %}
          <div class="divide-y dark-border">
            {% for producto in productos %}
            <div class="p-6 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
              <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                  <div class="w-12 h-12 bg-domi-gradient rounded-xl flex items-center justify-center text-2xl">
                    {{ ['🍔', '🍕', '🌮', '🍟', '🥤', '🍰'][loop.index0 % 6] }}
                  </div>
                  <div>
                    <h3 class="text-lg font-semibold dark-text">{{ producto.nombre }}</h3>
                    <p class="text-sm text-gray-600 dark:text-gray-400">
                      Precio unitario: ${{ "{:,.0f}".format(producto.precio_unitario) }}
                    </p>
                  </div>
                </div>
                
                <div class="text-right">
                  <div class="text-lg font-bold dark-text">x{{ producto.cantidad }}</div>
                  <div class="text-domi-orange font-bold">
                    ${{ "{:,.0f}".format(producto.precio_unitario * producto.cantidad) }}
                  </div>
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
          
          <!-- Total del pedido -->
          <div class="p-6 bg-gray-50 dark:bg-gray-800">
            <div class="flex justify-between items-center">
              <span class="text-xl font-bold dark-text">Total del Pedido:</span>
              <span class="text-2xl font-bold text-green-600 dark:text-green-400">
                ${{ "{:,.0f}".format(pedido.total) }}
              </span>
            </div>
          </div>
          {% else %}
          <div class="p-12 text-center">
            <div class="text-6xl mb-4">🍽️</div>
            <h3 class="text-xl font-semibold dark-text mb-2">No hay productos</h3>
            <p class="text-gray-600 dark:text-gray-400">Este pedido no tiene productos registrados</p>
          </div>
          {% endif %}
        </div>
      </div>
      
      <!-- Panel lateral -->
      <div class="lg:col-span-1">
        <!-- Información del cliente -->
        <div class="dark-card mb-6">
          <div class="p-6">
            <h3 class="text-lg font-bold dark-text mb-4 flex items-center gap-2">
              👤 Información del Cliente
            </h3>
            
            <div class="space-y-3">
              <div class="flex items-center space-x-3">
                <div class="w-10 h-10 bg-domi-orange bg-opacity-20 rounded-full flex items-center justify-center text-domi-orange font-bold">
                  {{ pedido.cliente[0].upper() if pedido.cliente else 'U' }}
                </div>
                <div>
                  <div class="font-medium dark-text">{{ pedido.cliente or 'Cliente Anónimo' }}</div>
                  <div class="text-sm text-gray-500 dark:text-gray-400">Cliente registrado</div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Cambiar estado del pedido -->
        {% if pedido.estped in ['pendiente', 'aceptado', 'preparando', 'en_camino'] %}
        <div class="dark-card">
          <div class="p-6">
            <h3 class="text-lg font-bold dark-text mb-4 flex items-center gap-2">
              🔄 Actualizar Estado
            </h3>
            
            <form action="{{ url_for('restaurante.cambiar_estado_pedido', idped=pedido.idped) }}" method="post" class="space-y-4">
              <div>
                <label class="block text-sm font-medium dark-text mb-2">Nuevo Estado:</label>
                <select name="estado" class="input" required>
                  <option value="pendiente" {% if pedido.estped == 'pendiente' %}selected{% endif %}>⏳ Pendiente</option>
                  <option value="aceptado" {% if pedido.estped == 'aceptado' %}selected{% endif %}>✅ Aceptado</option>
                  <option value="preparando" {% if pedido.estped == 'preparando' %}selected{% endif %}>👨‍🍳 Preparando</option>
                  <option value="en_camino" {% if pedido.estped == 'en_camino' %}selected{% endif %}>🚚 En Camino</option>
                  <option value="entregado" {% if pedido.estped == 'entregado' %}selected{% endif %}>🎉 Entregado</option>
                </select>
              </div>
              
              <button type="submit" class="btn-primary w-full">
                <span class="flex items-center justify-center gap-2">
                  <span>🔄</span>
                  <span>Actualizar Estado</span>
                </span>
              </button>
            </form>
          </div>
        </div>
        {% else %}
        <div class="dark-card">
          <div class="p-6 text-center">
            <div class="text-4xl mb-3">🎉</div>
            <h3 class="font-bold dark-text mb-2">Pedido Finalizado</h3>
            <p class="text-sm text-gray-600 dark:text-gray-400">
              Este pedido ya ha sido procesado completamente.
            </p>
          </div>
        </div>
        {% endif %}
        
        <!-- Información adicional -->
        <div class="dark-card mt-6">
          <div class="p-6">
            <h3 class="text-lg font-bold dark-text mb-4 flex items-center gap-2">
              📊 Detalles del Pedido
            </h3>
            
            <div class="space-y-3 text-sm">
              <div class="flex justify-between">
                <span class="text-gray-600 dark:text-gray-400">ID del Pedido:</span>
                <span class="font-medium dark-text">#{{ pedido.idped }}</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600 dark:text-gray-400">Fecha de Pedido:</span>
                <span class="font-medium dark-text">
                  {{ pedido.fecha_creacion.strftime('%d/%m/%Y') if pedido.fecha_creacion else 'No disponible' }}
                </span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600 dark:text-gray-400">Hora de Pedido:</span>
                <span class="font-medium dark-text">
                  {{ pedido.fecha_creacion.strftime('%H:%M') if pedido.fecha_creacion else 'No disponible' }}
                </span>
              </div>
              {% if pedido.fecha_actualizacion %}
              <div class="flex justify-between">
                <span class="text-gray-600 dark:text-gray-400">Última Actualización:</span>
                <span class="font-medium dark-text">
                  {{ pedido.fecha_actualizacion.strftime('%d/%m/%Y %H:%M') }}
                </span>
              </div>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.estado-badge {
  @apply px-4 py-2 rounded-full text-sm font-semibold inline-block;
}

.estado-pendiente {
  @apply bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200;
}

.estado-aceptado {
  @apply bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200;
}

.estado-preparando {
  @apply bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200;
}

.estado-en_camino {
  @apply bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200;
}

.estado-entregado {
  @apply bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200;
}

.estado-cancelado {
  @apply bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200;
}
</style>

<script>
// Confirmación antes de cambiar estado
document.querySelector('form').addEventListener('submit', function(e) {
    const select = this.querySelector('select[name="estado"]');
    const nuevoEstado = select.options[select.selectedIndex].text;
    
    if (!confirm(`¿Estás seguro de cambiar el estado a "${nuevoEstado}"?`)) {
        e.preventDefault();
    }
});
</script>
{% endblock %}
